/*
 * Bandwidth
 *
 * Bandwidth's Communication APIs
 *
 * The version of the OpenAPI document: 1.0.0
 * Contact: letstalk@bandwidth.com
 * Generated by: https://github.com/openapitools/openapi-generator.git
 */

using System;
using System.Net;
using System.Threading;
using System.Collections.Generic;
using Xunit;

using Bandwidth.Standard.Client;
using Bandwidth.Standard.Api;
using Bandwidth.Standard.Model;

namespace Bandwidth.Standard.Test.Smoke
{
    /// <summary>
    ///  Class for testing PhoneNumberLookupApi
    /// </summary>
    /// <remarks>
    /// This file is automatically generated by OpenAPI Generator (https://openapi-generator.tech).
    /// Please update the test case below to test the API endpoint.
    /// </remarks>
    public class PhoneNumberLookupSmokeTests : IDisposable
    {
        private PhoneNumberLookupApi instance;
        private string accountId;
        private Configuration configuration;
        private string bwNumber;
        private Guid requestId;

        public PhoneNumberLookupSmokeTests()
        {
            accountId = Environment.GetEnvironmentVariable("BW_ACCOUNT_ID");
            bwNumber = Environment.GetEnvironmentVariable("BW_NUMBER");

            // Authorized API Client
            configuration = new Configuration();
            configuration.Username = Environment.GetEnvironmentVariable("BW_USERNAME");
            configuration.Password = Environment.GetEnvironmentVariable("BW_PASSWORD");
            instance = new PhoneNumberLookupApi(configuration);
        }

        public void Dispose()
        {
            // Cleanup when everything is done.
        }

        /// <summary>
        /// Test an instance of PhoneNumberLookupApi
        /// </summary>
        [Fact]
        public void InstanceTest()
        {
            Assert.IsType<PhoneNumberLookupApi>(instance);
        }

        /// <summary>
        /// Test CreateAsyncBulkLookup
        /// </summary>
        [Fact]
        public void CreateGetAsyncBulkLookupTest()
        {
            AsyncLookupRequest asyncLookupRequest = new AsyncLookupRequest(
                phoneNumbers: new List<string> { bwNumber }
            );
            var createResponse = instance.CreateAsyncBulkLookupWithHttpInfo(accountId, asyncLookupRequest);
            Assert.IsType<ApiResponse<CreateAsyncBulkLookupResponse>>(createResponse);
            Assert.Equal(HttpStatusCode.Accepted, createResponse.StatusCode);
            Assert.NotNull(createResponse.Data);
            Assert.IsType<CreateAsyncBulkLookupResponse>(createResponse.Data);
            Assert.NotNull(createResponse.Data.Data);
            Assert.IsType<CreateAsyncBulkLookupResponseData>(createResponse.Data.Data);
            CreateAsyncBulkLookupResponseData createData = createResponse.Data.Data;
            Assert.IsType<Guid>(createData.RequestId);
            Assert.IsType<InProgressLookupStatusEnum>(createData.Status);
            requestId = createData.RequestId;

            Thread.Sleep(2000);

            var getResponse = instance.GetAsyncBulkLookupWithHttpInfo(accountId, requestId);
            Assert.IsType<ApiResponse<GetAsyncBulkLookupResponse>>(getResponse);
            Assert.Equal(HttpStatusCode.OK, getResponse.StatusCode);
            Assert.NotNull(getResponse.Data);
            Assert.IsType<GetAsyncBulkLookupResponse>(getResponse.Data);
            Assert.NotNull(getResponse.Data.Data);
            Assert.IsType<GetAsyncBulkLookupResponseData>(getResponse.Data.Data);
            GetAsyncBulkLookupResponseData getData = getResponse.Data.Data;
            Assert.Equal(getData.RequestId, requestId);
            Assert.IsType<InProgressLookupStatusEnum>(getData.Status);
            Assert.Equal(InProgressLookupStatusEnum.COMPLETE, getData.Status);
            Assert.IsType<List<LookupResult>>(getData.Results);
            Assert.NotEmpty(getData.Results);
            Assert.Equal(bwNumber, getData.Results[0].PhoneNumber);
            Assert.IsType<LineTypeEnum>(getData.Results[0].LineType);
            Assert.Equal(LineTypeEnum.VOIP, getData.Results[0].LineType);
            Assert.Equal("AdHoc P2P - Bandwidth - SVR", getData.Results[0].MessagingProvider);
            Assert.Equal("BANDWIDTH", getData.Results[0].VoiceProvider);
            Assert.Equal("USA", getData.Results[0].CountryCodeA3);
            Assert.IsType<LatestMessageDeliveryStatusEnum>(getData.Results[0].LatestMessageDeliveryStatus);
            Assert.IsType<DateTime>(getData.Results[0].InitialMessageDeliveryStatusDate);
            Assert.IsType<DateTime>(getData.Results[0].LatestMessageDeliveryStatusDate);
        }

        /// <summary>
        /// Test CreateSyncLookup
        /// </summary>
        [Fact]
        public void CreateSyncLookupTest()
        {
            SyncLookupRequest syncLookupRequest = new SyncLookupRequest(
                phoneNumbers: new List<string> { bwNumber }
            );
            var response = instance.CreateSyncLookupWithHttpInfo(accountId, syncLookupRequest);
            Assert.IsType<ApiResponse<CreateSyncLookupResponse>>(response);
            Assert.Equal(HttpStatusCode.OK, response.StatusCode);
            Assert.NotNull(response.Data);
            Assert.IsType<CreateSyncLookupResponse>(response.Data);
            Assert.NotNull(response.Data.Data);
            Assert.IsType<CreateSyncLookupResponseData>(response.Data.Data);
            CreateSyncLookupResponseData data = response.Data.Data;
            Assert.IsType<Guid>(data.RequestId);
            Assert.IsType<CompletedLookupStatusEnum>(data.Status);
            Assert.Equal(CompletedLookupStatusEnum.COMPLETE, data.Status);
            Assert.IsType<List<LookupResult>>(data.Results);
            Assert.NotEmpty(data.Results);
            Assert.Equal(bwNumber, data.Results[0].PhoneNumber);
            Assert.IsType<LineTypeEnum>(data.Results[0].LineType);
            Assert.Equal(LineTypeEnum.VOIP, data.Results[0].LineType);
            Assert.Equal(data.Results[0].MessagingProvider, "AdHoc P2P - Bandwidth - SVR");
            Assert.Equal(data.Results[0].VoiceProvider, "BANDWIDTH");
            Assert.Equal(data.Results[0].CountryCodeA3, "USA");
            Assert.IsType<LatestMessageDeliveryStatusEnum>(data.Results[0].LatestMessageDeliveryStatus);
            Assert.IsType<DateTime>(data.Results[0].InitialMessageDeliveryStatusDate);
            Assert.IsType<DateTime>(data.Results[0].LatestMessageDeliveryStatusDate);
        }
    }
}
